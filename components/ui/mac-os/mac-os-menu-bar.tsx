"use client";

import React, { useState, useEffect, useRef, useCallback } from "react";
import { useRouter, usePathname } from "next/navigation";
import { useApp } from '@/contexts/AppContext';

// Types
interface MenuItemOption {
  label: string;
  action?: string;
  shortcut?: string;
  type?: "item" | "separator";
  hasSubmenu?: boolean;
}

interface MenuConfig {
  label: string;
  items?: MenuItemOption[];
  action?: string;
}

interface MacOSMenuBarProps {
  appName?: string;
  menus?: MenuConfig[];
  onMenuAction?: (action: string) => void;
  className?: string;
}

// Default Finder menus
const DEFAULT_MENUS: MenuConfig[] = [
  {
    label: "File",
    items: [
      { label: "About Me", action: "go-about" },
      { label: "Projects", action: "go-projects", shortcut: "⌘1" },
      { label: "Skills", action: "go-skills", shortcut: "⌘2" },
      { label: "Experience", action: "go-experience", shortcut: "⌘3" },
      { label: "Separator", type: "separator" },
      { label: "Download Resume…", action: "download-resume", shortcut: "⌘S" },
      {
        label: "Share Portfolio…",
        action: "share-portfolio",
        hasSubmenu: true,
      },
      { label: "Separator", type: "separator" },
      { label: "Print This Page…", action: "print-page", shortcut: "⌘P" },
    ],
  },
  {
    label: "Edit",
    items: [
      { label: "Copy Email Address", action: "copy-email", shortcut: "⌘E" },
      { label: "Copy Phone Number", action: "copy-phone" },
      { label: "Separator", type: "separator" },
      {
        label: "Search Portfolio…",
        action: "search-portfolio",
        shortcut: "⌘K", // Standard command palette shortcut
      },
    ],
  },
  {
    label: "View",
    items: [
      { label: "Enable Light Mode", action: "light-mode", shortcut: "⌥⌘1" },
      { label: "Enable Dark Mode", action: "dark-mode", shortcut: "⌥⌘2" },
      { label: "Separator", type: "separator" },

      {
        label: "Show Only Projects",
        action: "filter-projects",
        shortcut: "⌥⌘3",
      },
      {
        label: "Show Only Experience",
        action: "filter-experience",
        shortcut: "⌥⌘4",
      },
      { label: "Separator", type: "separator" },
      { label: "Enter Fullscreen", action: "fullscreen", shortcut: "⌃⌘F" },
    ],
  },
  {
    label: "Window",
    items: [
      { label: "Minimize All", action: "minimize-all", shortcut: "⌘M" },
      { label: "Close All Windows", action: "close-all", shortcut: "⌥⌘W" },
      { label: "Separator", type: "separator" },
      { label: "Reload Portfolio", action: "reload-portfolio", shortcut: "⌘R" },
    ],
  },
  {
    label: "Resume",
    action: "open-resume",
  },
];

// Apple menu items
const APPLE_MENU_ITEMS: MenuItemOption[] = [
  { label: "About This Portfolio", action: "about-portfolio" },
  { label: "Separator", type: "separator" },
  { label: "Visit My GitHub", action: "open-github" },
  { label: "Visit My LinkedIn", action: "open-linkedin" },
  { label: "Separator", type: "separator" },
  { label: "Contact Me", action: "contact-me", shortcut: "⌘K" },
  { label: "Report an Issue…", action: "report-issue" },
  { label: "Separator", type: "separator" },
  { label: "Restart Navigation", action: "reset-navigation" },
];

// MenuDropdown Component (bundled inside)
interface MenuDropdownProps {
  isOpen: boolean;
  onClose: () => void;
  items: MenuItemOption[];
  position: { x: number; y: number };
  onAction?: (action: string) => void;
}

const MenuDropdown: React.FC<MenuDropdownProps> = ({
  isOpen,
  onClose,
  items,
  position,
  onAction,
}) => {
  const dropdownRef = useRef<HTMLDivElement>(null);
  const [isFullscreen, setIsFullscreen] = useState(false);

  useEffect(() => {
    const handleFSChange = () => {
      setIsFullscreen(!!document.fullscreenElement);
    };

    document.addEventListener("fullscreenchange", handleFSChange);
    return () =>
      document.removeEventListener("fullscreenchange", handleFSChange);
  }, []);
  useEffect(() => {
    const handleClickOutside = (event: MouseEvent) => {
      if (
        dropdownRef.current &&
        !dropdownRef.current.contains(event.target as Node)
      ) {
        onClose();
      }
    };

    if (isOpen) {
      document.addEventListener("mousedown", handleClickOutside);
    }

    return () => {
      document.removeEventListener("mousedown", handleClickOutside);
    };
  }, [isOpen, onClose]);

  if (!isOpen) return null;

  return (
    <div
      ref={dropdownRef}
      className="absolute backdrop-blur-md z-[60]"
      style={{
        left: `${position.x}px`,
        top: `${position.y}px`,
        background: "rgba(40, 40, 40, 0.75)",
        border: "1px solid rgba(255, 255, 255, 0.18)",
        borderRadius: "8px",
        boxShadow: `
          0 8px 32px rgba(0, 0, 0, 0.4),
          0 2px 8px rgba(0, 0, 0, 0.3),
          inset 0 1px 0 rgba(255, 255, 255, 0.12)
        `,
        minWidth: "220px",
        animation: "menuFadeIn 0.15s cubic-bezier(0.23, 1, 0.32, 1) forwards",
      }}
    >
      <div className="py-1">
        {items.map((item, index) => {
          if (item.type === "separator") {
            return <div key={index} className="h-px bg-white/15 mx-2 my-1" />;
          }

          return (
            <div
              key={index}
              className="px-4 py-1 text-white text-sm cursor-pointer hover:bg-white/10 transition-colors duration-100 flex justify-between items-center"
              onClick={() => {
                if (item.action) {
                  onAction?.(item.action);
                }
                onClose();
              }}
            >
              <span className="flex items-center">
                {item.action === "fullscreen"
                  ? isFullscreen
                    ? "Exit Fullscreen"
                    : "Enter Fullscreen"
                  : item.label}
                {item.hasSubmenu && (
                  <span className="ml-2 text-xs opacity-70">▶</span>
                )}
              </span>
              {item.shortcut && (
                <span className="text-xs text-white/60 ml-4">
                  {item.shortcut}
                </span>
              )}
            </div>
          );
        })}
      </div>

      <style jsx>{`
        @keyframes menuFadeIn {
          from {
            opacity: 0;
            transform: scale(0.95) translateY(-5px);
          }
          to {
            opacity: 1;
            transform: scale(1) translateY(0);
          }
        }
      `}</style>
    </div>
  );
};

const MacOSMenuBar: React.FC<MacOSMenuBarProps> = ({
  appName = "Daiwiik Harihar's Portfolio",
  menus = DEFAULT_MENUS,
  onMenuAction,
  className = "",
}) => {
  const { currentApp, setCurrentApp } = useApp(); // Get current app from context
  const router = useRouter();
  const pathname = usePathname(); // Add usePathname to track route changes
  const [scale, setScale] = useState(1);

  // --- FUNCTIONALITY: Update App Name based on Route ---
  useEffect(() => {
    if (!pathname) return;
    
    let name = "Daiwiik's Portfolio";
    if (pathname.includes("projects")) name = "VS Code";
    else if (pathname.includes("contact")) name = "Mail";
    else if (pathname.includes("about")) name = "Finder";
    else if (pathname.includes("designs")) name = "Figma";
    else if (pathname.includes("experience")) name = "Calendar";
    else if (pathname.includes("resume")) name = "Preview";
    
    // Only update if it's different to avoid loops
    if (currentApp !== name) {
      setCurrentApp(name);
    }
  }, [pathname, setCurrentApp, currentApp]);


  useEffect(() => {
    const updateScale = () => {
      const width = window.innerWidth;

      // Exact macOS behavior:
      if (width < 380) setScale(0.78);
      else if (width < 480) setScale(0.85);
      else if (width < 640) setScale(0.92);
      else setScale(1);
    };

    updateScale();
    window.addEventListener("resize", updateScale);
    return () => window.removeEventListener("resize", updateScale);
  }, []);
  
  const [currentTime, setCurrentTime] = useState("");
  const [activeMenu, setActiveMenu] = useState<string | null>(null);
  const [dropdownPosition, setDropdownPosition] = useState({ x: 0, y: 0 });

  const appleLogoRef = useRef<HTMLDivElement>(null);
  const menuRefs = useRef<{ [key: string]: HTMLSpanElement | null }>({});

  // Clock logic (unchanged)
  useEffect(() => {
    const updateTime = () => {
      const now = new Date();
      setCurrentTime(
        now.toLocaleTimeString("en-US", {
          hour: "numeric",
          minute: "2-digit",
          hour12: true,
        })
      );
    };
    updateTime();
    const interval = setInterval(updateTime, 60000);
    return () => clearInterval(interval);
  }, []);

  // --- FUNCTIONALITY: Core Action Logic ---
  const handleMenuAction = useCallback(
    async (action: string) => {
      // ----------- EXTERNAL LINKS -----------
      if (action === "open-github") {
        window.open("https://github.com/daiv09", "_blank");
        return;
      }

      if (action === "open-linkedin") {
        window.open("https://linkedin.com/in/daiwiik-harihar/", "_blank");
        return;
      }

      // ----------- PORTFOLIO NAVIGATION -----------
      if (action === "go-home") router.push("/");
      if (action === "go-about") router.push("/about");
      if (action === "go-projects") router.push("/projects");
      if (action === "go-skills") router.push("/skills");
      if (action === "go-experience") router.push("/experience");
      if (action === "go-designs") router.push("/designs");
      if (action === "go-contact") router.push("/contact");

      // ----------- SCROLLING (same page) -----------
      if (action === "scroll-top")
        window.scrollTo({ top: 0, behavior: "smooth" });
      if (action === "scroll-bottom")
        window.scrollTo({
          top: document.body.scrollHeight,
          behavior: "smooth",
        });

      // ----------- RESUME / DOWNLOADS -----------
      if (action === "download-resume") {
        window.open("/resume.pdf", "_blank");
      }

      if (action === "open-resume") {
        router.push("/resume");
      }

      // ----------- SHARE PORTFOLIO -----------
      if (action === "share-portfolio") {
        if (navigator.share) {
          navigator.share({
            title: "Daiwiik's Portfolio",
            text: "Check out this developer portfolio!",
            url: window.location.href,
          }).catch(console.error);
        } else {
          // Fallback
          navigator.clipboard.writeText(window.location.href);
          alert("Link copied to clipboard!");
        }
      }

      // ----------- PRINT PAGE -----------
      if (action === "print-page") {
        window.print();
      }

      // ----------- CLIPBOARD ACTIONS -----------
      if (action === "copy-email") {
        await navigator.clipboard.writeText("daiwiikharihar@gmail.com"); // Replace with actual email
        // alert("Email copied to clipboard"); 
      }
      
      if (action === "copy-phone") {
        await navigator.clipboard.writeText("+91 7755921891"); // Replace with actual phone
        // alert("Phone number copied to clipboard");
      }

      // ----------- CONTACT ME -----------
      if (action === "contact-me") {
        router.push("/contact");
      }

      // ----------- REPORT ISSUE -----------
      if (action === "report-issue") {
        window.open("https://github.com/daiv09/portfolio-v2/issues", "_blank");
      }

      // ----------- MODE SWITCH -----------
      if (action === "light-mode") {
        document.documentElement.classList.remove("dark");
        localStorage.setItem("theme", "light");
      }

      if (action === "dark-mode") {
        document.documentElement.classList.add("dark");
        localStorage.setItem("theme", "dark");
      }

      // ----------- FILTER SECTIONS (custom) -----------
      // Maps to query params that your page components should listen to
      if (action === "filter-projects") router.push("/projects?view=all");
      if (action === "filter-experience") router.push("/experience?view=all");

      // ----------- FULLSCREEN -----------
      if (action === "fullscreen") {
        if (!document.fullscreenElement) {
          document.documentElement.requestFullscreen().catch(e => console.error(e));
        } else {
          document.exitFullscreen().catch(e => console.error(e));
        }
      }

      // ----------- WINDOW MANAGEMENT -----------
      if (action === "reload-portfolio") {
        window.location.reload();
      }

      if (action === "minimize-all" || action === "close-all") {
        // "Minimize" effectively goes to home in a single page app context
        router.push("/");
      }

      if (action === "reset-navigation") {
        router.push("/");
        window.scrollTo({ top: 0, behavior: "smooth" });
      }

      // ----------- SEARCH -----------
      if (action === "search-portfolio") {
        // Since we don't have a complex global context, we use a prompt or dispatch event
        // If you add the Spotlight component later, listen for this event:
        window.dispatchEvent(new CustomEvent('toggle-spotlight'));
        
        // Temporary fallback if no event listener handles it
        // const query = prompt("Quick Search (Pages, Projects...):");
        // if (query) router.push(`/search?q=${query}`);
      }
      
      // ----------- ABOUT -----------
      if (action === "about-portfolio") {
        alert("Daiwiik Harihar's Portfolio\nVersion 2.0.0 (Build 2025)\n\nBuilt with Next.js, Tailwind, and React.");
      }

      // Trigger custom callback if parent wants it
      onMenuAction?.(action);
    },
    [router, onMenuAction]
  );

  // --- FUNCTIONALITY: Keyboard Shortcuts ---
  useEffect(() => {
    const handleKeyDown = (e: KeyboardEvent) => {
      // Helper to check for Command (Mac) or Ctrl (Windows)
      const isCmd = e.metaKey || e.ctrlKey;
      
      if (!isCmd) return;

      switch(e.key.toLowerCase()) {
        case 'k': 
          e.preventDefault();
          handleMenuAction('search-portfolio'); // or contact-me based on menu config
          break;
        case 's':
          e.preventDefault();
          handleMenuAction('download-resume');
          break;
        case 'p':
          e.preventDefault();
          handleMenuAction('print-page');
          break;
        case 'm':
          e.preventDefault();
          handleMenuAction('minimize-all');
          break;
        case 'r':
          if (!e.shiftKey) { // CMD+R is reload naturally, but we can intercept if needed
             // let browser handle reload, or:
             // e.preventDefault(); handleMenuAction('reload-portfolio');
          }
          break;
        // Add more shortcuts as defined in your DEFAULT_MENUS
      }
    };

    window.addEventListener("keydown", handleKeyDown);
    return () => window.removeEventListener("keydown", handleKeyDown);
  }, [handleMenuAction]);


  // Menu toggling logic (unchanged)
  const handleAppleMenuClick = useCallback(() => {
    if (activeMenu === "apple") setActiveMenu(null);
    else {
      if (appleLogoRef.current) {
        const rect = appleLogoRef.current.getBoundingClientRect();
        const parentRect =
          appleLogoRef.current.offsetParent?.getBoundingClientRect() || {
            left: 0,
            top: 0,
          };
        setDropdownPosition({ x: rect.left - parentRect.left, y: 34 });
      }
      setActiveMenu("apple");
    }
  }, [activeMenu]);

  const handleMenuItemClick = useCallback(
    (menuLabel: string) => {
      const menu = menus.find((m) => m.label === menuLabel);

      // If this menu triggers an action directly (no items), run action
      if (menu && menu.action && (!menu.items || menu.items.length === 0)) {
        handleMenuAction(menu.action);
        return;
      }

      // Otherwise: open dropdown normally
      if (activeMenu === menuLabel) setActiveMenu(null);
      else {
        const menuRef = menuRefs.current[menuLabel];
        if (menuRef) {
          const rect = menuRef.getBoundingClientRect();
          const parentRect = menuRef.offsetParent?.getBoundingClientRect() || {
            left: 0,
            top: 0,
          };
          setDropdownPosition({
            x: rect.left - parentRect.left,
            y: 34,
          });
          setActiveMenu(menuLabel);
        }
      }
    },
    [activeMenu, menus, handleMenuAction]
  );

  const closeDropdown = useCallback(() => setActiveMenu(null), []);

  return (
    <div style={{ position: "relative" }}>
      {/* Responsive scale wrapper */}
      <div
        style={{
          width: "100%",
          display: "flex",
          justifyContent: "center",
          transform: `scale(${scale})`,
          transformOrigin: "top left",
        }}
      >
        {/* MAIN MENU BAR */}
        <div
          className={`backdrop-blur-md ${className}`}
          style={{
            height: "32px",
            width: "100%",
            background: "rgba(40, 40, 40, 0.65)",
            border: "1px solid rgba(255, 255, 255, 0.12)",
            borderRadius: "8px",
            boxShadow: `
            0 2px 8px rgba(0, 0, 0, 0.2),
            inset 0 1px 0 rgba(255, 255, 255, 0.12)
          `,
          }}
        >
          <div className="flex justify-between items-center h-full px-4">
            {/* Left section - Apple logo and app menus */}
            <div className="flex items-center space-x-4">
              {/* Apple Logo */}
              <div
                ref={appleLogoRef}
                onClick={handleAppleMenuClick}
                className="cursor-pointer hover:opacity-80 transition-opacity duration-150"
              >
                <svg
                  width="15"
                  height="19"
                  viewBox="0 0 110 140"
                  fill="white"
                  style={{ display: "block" }}
                >
                  <path
                    d="M0 0 C5.58236403 2.09904125 9.60467483 0.88914551 14.97265625 -1.09375 C24.52115711 -4.439908 34.11309717 -4.54862597 43.35546875 -0.23046875 C48.12396107 2.4076135 50.86575425 5.08527779 53.41015625 9.90625 C52.35828125 10.69 51.30640625 11.47375 50.22265625 12.28125 C44.71078889 17.03285979 41.56508326 23.28635633 40.47265625 30.46875 C40.03168138 38.29605399 41.87292643 44.10920342 46.82421875 50.18359375 C49.69950343 53.3067478 52.89615914 55.56358526 56.41015625 57.90625 C53.62981681 69.36905295 47.16852412 82.51930379 37.16015625 89.40625 C32.57853571 91.90531575 28.55304343 92.53884155 23.41015625 91.90625 C21.37403354 91.28785199 19.35323208 90.61750058 17.34765625 89.90625 C8.57237805 86.84256185 3.23794872 88.20952158 -5.43359375 91.00390625 C-10.61364364 92.48483636 -14.47478385 92.64004629 -19.65234375 90.84375 C-33.68747534 81.58653555 -41.78781841 64.33028781 -45.19067383 48.33569336 C-47.46721739 34.48010623 -46.65131557 19.75938694 -38.46484375 8.03125 C-28.23499655 -4.14713952 -14.17528672 -5.71090688 0 0 Z"
                    transform="translate(45.58984375,33.09375)"
                  />
                  <path
                    d="M0 0 C0.57231958 7.72631433 -0.96546021 14.10973315 -5.80078125 20.30859375 C-10.93255592 25.73930675 -15.29387058 28.82351765 -22.9375 29.1875 C-23.948125 29.125625 -24.95875 29.06375 -26 29 C-26.59493662 20.81962143 -24.35167303 14.76774508 -19.375 8.25 C-14.46051828 2.89895264 -7.38077314 -0.97115436 0 0 Z"
                    transform="translate(76,0)"
                  />
                </svg>
              </div>

              {/* Current App Name */}
              <span className="text-white text-sm font-semibold">
                {currentApp || "Daiwiik Harihar's Portfolio"}
              </span>

              {/* Menu Items */}
              <div className="flex items-center space-x-6">
                {menus.map((menu) => (
                  <span
                    key={menu.label}
                    ref={(el) => {
                      menuRefs.current[menu.label] = el;
                    }}
                    className="text-white text-sm cursor-pointer hover:opacity-80 transition-opacity duration-150 select-none"
                    onClick={() => handleMenuItemClick(menu.label)}
                  >
                    {menu.label}
                  </span>
                ))}
              </div>
            </div>

            {/* Right section - status icons and clock */}
            <div className="flex items-center space-x-4">
              {/* Battery */}
              <div className="cursor-pointer hover:opacity-80 transition-opacity duration-150">
                <svg
                  width="26"
                  height="12"
                  viewBox="0 0 190 90"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    d="M0 0 C0.82175217 -0.00511093 1.64350433 -0.01022186 2.49015808 -0.01548767 C5.19859152 -0.0293548 7.90676972 -0.02842931 10.61523438 -0.02612305 C12.50183201 -0.03001108 14.38842878 -0.03434597 16.27502441 -0.03910828 C20.22585897 -0.04656393 24.17660415 -0.04628359 28.12744141 -0.04101562 C33.18827521 -0.0352167 38.24874354 -0.05216538 43.30951691 -0.0753603 C47.20430639 -0.09009567 51.09900777 -0.09096969 54.99382019 -0.08785057 C56.85972315 -0.08836371 58.72563106 -0.09360009 60.59150696 -0.10366249 C63.20056908 -0.11600809 65.80891792 -0.10924706 68.41796875 -0.09765625 C69.18694992 -0.10529999 69.95593109 -0.11294373 70.74821472 -0.12081909 C76.48807519 -0.06449799 79.68979749 1.25547132 83.70898438 5.2746582 C85.12279298 9.05552515 84.88869294 13.09189823 84.91210938 17.07543945 C84.91780945 17.83003952 84.92350952 18.58463959 84.92938232 19.36210632 C84.93881056 20.95655932 84.94535764 22.55103161 84.94921875 24.14550781 C84.95890962 26.56846642 84.98994637 28.99057084 85.02148438 31.41333008 C85.02801682 32.96736153 85.03326635 34.52139902 85.03710938 36.07543945 C85.04945618 36.79234451 85.06180298 37.50924957 85.07452393 38.24787903 C85.05202575 43.40022518 84.24732046 46.86576899 81.70898438 51.2746582 C77.44198652 53.68062086 73.09614556 53.56449915 68.32617188 53.54931641 C67.49466614 53.55442734 66.6631604 53.55953827 65.80645752 53.56480408 C63.06555937 53.57867253 60.32491338 53.57774562 57.58398438 53.57543945 C55.6749665 53.57932741 53.76594949 53.58366229 51.85693359 53.58842468 C47.85902093 53.59588062 43.86119658 53.59559979 39.86328125 53.59033203 C34.74191497 53.58453311 29.62090983 53.60148166 24.49960327 53.6246767 C20.5584909 53.63941144 16.61746561 53.64028618 12.67633057 53.63716698 C10.788099 53.63768015 8.89986255 53.64291715 7.01165771 53.6529789 C4.37146537 53.66532324 1.73197803 53.65856418 -0.90820312 53.64697266 C-2.07570099 53.65843826 -2.07570099 53.65843826 -3.26678467 53.6701355 C-7.79019075 53.62626694 -10.68014088 53.04878224 -14.29101562 50.2746582 C-17.11730625 46.65525677 -16.59684928 42.17147887 -16.59179688 37.7824707 C-16.596082 36.95891083 -16.60036713 36.13535095 -16.6047821 35.28683472 C-16.61051687 33.54694537 -16.61103195 31.80703205 -16.60668945 30.06713867 C-16.60353488 27.4158396 -16.62697968 24.76566273 -16.65234375 22.11450195 C-16.65461749 20.42049294 -16.65531989 18.72648094 -16.65429688 17.0324707 C-16.66350662 16.24478302 -16.67271637 15.45709534 -16.6822052 14.64553833 C-16.64212062 9.83558309 -16.12088551 6.35019582 -13.29101562 2.2746582 C-9.00849445 -0.06521491 -4.75970999 -0.0153343 0 0 Z "
                    fill="#FFFFFF"
                    transform="translate(31.291015625,14.725341796875)"
                  />
                  <path
                    d="M0 0 C1.03584732 -0.00571014 2.07169464 -0.01142029 3.13893127 -0.01730347 C4.26990234 -0.01842133 5.40087341 -0.01953918 6.56611633 -0.02069092 C8.35947166 -0.02813828 8.35947166 -0.02813828 10.1890564 -0.03573608 C13.4661846 -0.04783365 16.74327716 -0.05530034 20.02042365 -0.05974674 C22.07083709 -0.06268252 24.12124501 -0.06678835 26.17165565 -0.07125092 C32.59544399 -0.08492098 39.01921961 -0.09458922 45.44302148 -0.09845281 C52.84210819 -0.10292813 60.24100968 -0.1204535 67.6400401 -0.1494534 C73.36930485 -0.17112394 79.09851771 -0.18115999 84.82782298 -0.18249393 C88.24476141 -0.18353841 91.6615256 -0.18936922 95.07842064 -0.20731354 C98.89607549 -0.22441187 102.71328223 -0.22248399 106.53096008 -0.21600342 C107.65181 -0.2252182 108.77265991 -0.23443298 109.92747498 -0.243927 C117.95269142 -0.20135944 124.42140542 0.86173116 131.18452454 5.32794189 C136.30866063 10.6904099 138.96352158 16.97584486 139.03315735 24.39898682 C139.04276489 25.2305278 139.05237244 26.06206879 139.06227112 26.91880798 C139.06864594 28.2563488 139.06864594 28.2563488 139.07514954 29.62091064 C139.08084961 30.54833572 139.08654968 31.4757608 139.09242249 32.43128967 C139.10186112 34.39398055 139.10840195 36.35668719 139.11225891 38.31939697 C139.12193301 41.2997461 139.15295424 44.27939605 139.18452454 47.25958252 C139.19105839 49.17168782 139.19630736 51.08379804 139.20014954 52.99591064 C139.21249634 53.87748337 139.22484314 54.75905609 139.23756409 55.66734314 C139.21227077 62.80842015 138.04416634 69.6473711 133.62202454 75.45294189 C121.3613082 87.43500559 100.42474177 84.44038848 84.55952454 84.40606689 C82.33385679 84.40741811 80.10818933 84.40936241 77.88252258 84.41186523 C73.24325214 84.41479505 68.60405931 84.41058841 63.96479797 84.40118408 C58.06132833 84.38979096 52.15804063 84.396362 46.25457764 84.40832901 C41.6662411 84.41560584 37.07794667 84.41323313 32.48960876 84.40807343 C30.31462074 84.40675298 28.13962872 84.40832734 25.96464539 84.41303253 C-10.09097031 84.47394262 -10.09097031 84.47394262 -18.12797546 77.14044189 C-23.90359816 71.3648192 -25.45954292 64.46402857 -25.54481506 56.57830811 C-25.53874237 55.66037476 -25.53266968 54.74244141 -25.52641296 53.79669189 C-25.52928314 52.82816284 -25.53215332 51.85963379 -25.53511047 50.86175537 C-25.5371418 48.82459932 -25.5316775 46.78742334 -25.51908875 44.75030518 C-25.50302206 41.64943422 -25.51896955 38.54986653 -25.53813171 35.44903564 C-25.53614912 33.46075155 -25.5323051 31.47246825 -25.52641296 29.48419189 C-25.53248566 28.56625854 -25.53855835 27.6483252 -25.54481506 26.70257568 C-25.46603492 19.41721627 -24.07647694 14.03535838 -19.94047546 7.89044189 C-14.28843724 2.36400452 -7.83600922 0.02592702 0 0 Z M-12.12797546 14.82794189 C-16.85057138 22.64974138 -16.47096343 31.04435231 -16.44364929 39.92144775 C-16.4404874 42.06983139 -16.46401315 44.21683688 -16.48930359 46.36505127 C-16.72736225 58.22940199 -16.72736225 58.22940199 -11.85282898 68.71026611 C-5.34263349 74.74736513 2.67544426 74.43516039 10.98872375 74.4151001 C12.08719635 74.42021103 13.18566895 74.42532196 14.31742859 74.43058777 C17.93724565 74.44445184 21.55687163 74.44352931 25.17671204 74.44122314 C27.70105561 74.44511188 30.22539853 74.44944692 32.7497406 74.45420837 C38.03710827 74.4616638 43.32440627 74.46152321 48.61177063 74.45611572 C54.70516317 74.45007927 60.79832461 74.46238391 66.89167774 74.48368579 C72.77512247 74.50349016 78.65847729 74.5064679 84.54195023 74.50295067 C87.03533089 74.50346296 89.52871531 74.50868326 92.02207565 74.51876259 C95.51374184 74.5311454 99.00487808 74.52432362 102.49653625 74.51275635 C103.51916565 74.52040009 104.54179504 74.52804382 105.59541321 74.53591919 C113.22652315 74.48024712 120.0214064 73.74845424 125.80952454 68.45294189 C130.56241065 60.81951874 130.21555801 52.56684234 130.18769836 43.84161377 C130.18454163 41.77662136 130.20804614 39.71307024 130.23335266 37.64825439 C130.40830464 25.44302856 130.40830464 25.44302856 125.63227844 14.5022583 C119.1868619 8.43943647 110.09608162 8.84539037 101.84126282 8.86578369 C100.76375763 8.86067276 99.68625244 8.85556183 98.57609558 8.85029602 C95.03145213 8.83645148 91.48700424 8.83735298 87.94233704 8.83966064 C85.46665882 8.83577087 82.99098126 8.83143562 80.51530457 8.82667542 C75.33226862 8.81922422 70.14930081 8.81949652 64.96626282 8.82476807 C58.34000023 8.83056079 51.71401734 8.81363077 45.08780098 8.79042339 C39.97640872 8.77565762 34.86508337 8.77481825 29.75367355 8.77793312 C27.31135886 8.77742133 24.86904028 8.77221043 22.42674637 8.7621212 C19.0048403 8.74971941 15.58347342 8.75657139 12.16157532 8.76812744 C11.16281372 8.7604837 10.16405212 8.75283997 9.13502502 8.7449646 C1.89083821 8.7987594 -6.88444207 9.18240837 -12.12797546 14.82794189 Z "
                    fill="#FFFFFF"
                    transform="translate(25.127975463867188,-0.14044189453125)"
                  />
                  <path
                    d="M0 0 C6.61183005 2.20394335 7.27129348 2.77981088 11 8 C12.63537738 12.90613215 12.50113348 17.88031198 12 23 C10.1875 26.5625 10.1875 26.5625 8 29 C7.2884375 29.8971875 7.2884375 29.8971875 6.5625 30.8125 C5 32 5 32 0 33 C0 22.11 0 11.22 0 0 Z "
                    fill="#FFFFFF"
                    transform="translate(171,25)"
                  />
                </svg>
              </div>

              {/* WiFi */}
              <div className="cursor-pointer hover:opacity-80 transition-opacity duration-150">
                <svg
                  width="20"
                  height="14"
                  viewBox="0 0 150 110"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    d="M0 0 C0.65500488 0.20898926 1.31000977 0.41797852 1.98486328 0.63330078 C14.82324128 4.91062412 25.79730909 11.812883 35.8125 20.8125 C36.57759888 21.49638794 36.57759888 21.49638794 37.3581543 22.1940918 C39.29498348 24.01298915 40.84104556 25.67845094 42.0234375 28.0703125 C41.98868831 30.93132924 40.7368247 32.00327419 38.8125 34.0625 C38.20019531 34.73410156 37.58789062 35.40570313 36.95703125 36.09765625 C33.07626002 39.86998278 33.07626002 39.86998278 31 41 C26.85231569 40.06955581 24.51783886 37.81497315 21.5625 34.875 C4.56703863 19.28329355 -16.81223148 15.07788117 -39.23388672 15.82958984 C-58.92928161 17.04295133 -76.63301992 28.19464819 -91 41 C-96.17940014 39.58743632 -99.965861 36.34834456 -103 32 C-103.39867702 28.27901445 -102.98432718 26.38320487 -100.8046875 23.3203125 C-76.41780756 -3.27241587 -33.31208663 -10.63151701 0 0 Z"
                    fill="#FFFFFF"
                    transform="translate(103,4)"
                  />
                  <path
                    d="M0 0 C1.8984375 2.05078125 1.8984375 2.05078125 2.8984375 5.05078125 C0.89685511 7.9957076 -1.65789629 10.46703226 -4.1015625 13.05078125 C-5.1534375 14.31921875 -5.1534375 14.31921875 -6.2265625 15.61328125 C-8.1015625 17.05078125 -8.1015625 17.05078125 -10.4609375 16.84375 C-13.41993192 15.95517623 -14.91300535 14.82404416 -17.2265625 12.80078125 C-27.98918153 4.03925219 -39.5915468 1.83255625 -53.1015625 3.05078125 C-61.85246663 4.93211813 -69.21440161 9.60534319 -75.8515625 15.48828125 C-78.1015625 17.05078125 -78.1015625 17.05078125 -80.44140625 16.9140625 C-83.77758701 15.83139591 -85.4436323 14.27530835 -87.9140625 11.80078125 C-88.70425781 11.0325 -89.49445313 10.26421875 -90.30859375 9.47265625 C-92.1015625 7.05078125 -92.1015625 7.05078125 -92.62109375 4.52734375 C-91.49952622 -0.81907591 -86.29726382 -3.87482782 -82.1015625 -6.94921875 C-74.21821198 -11.66652861 -66.12451308 -15.1700454 -57.1015625 -16.94921875 C-56.39128906 -17.09101562 -55.68101563 -17.2328125 -54.94921875 -17.37890625 C-34.50294745 -20.50105568 -14.99849748 -13.69736599 0 0 Z"
                    fill="#FFFFFF"
                    transform="translate(117.1015625,53.94921875)"
                  />
                  <path
                    d="M0 0 C2.55892967 1.51276457 3.9662918 2.74643145 6 5 C6.5234375 7.25390625 6.5234375 7.25390625 6 10 C4.23657597 12.43682265 2.11984755 14.43955796 -0.0625 16.5 C-0.62388672 17.05558594 -1.18527344 17.61117187 -1.76367188 18.18359375 C-5.58232446 21.89314197 -9.39060132 25.31429256 -14 28 C-19.80211565 26.44161162 -23.60213327 22.18619112 -27.875 18.1875 C-28.67164063 17.47529297 -29.46828125 16.76308594 -30.2890625 16.02929688 C-31.03671875 15.33255859 -31.784375 14.63582031 -32.5546875 13.91796875 C-33.24030762 13.28656982 -33.92592773 12.6551709 -34.63232422 12.00463867 C-36 10 -36 10 -35.83251953 7.4152832 C-34.58453344 3.79465962 -33.03776765 2.36945876 -30 0 C-18.999621 -5.30221711 -11.00576064 -5.15947378 0 0 Z"
                    fill="#FFFFFF"
                    transform="translate(87,77)"
                  />
                </svg>
              </div>

              {/* Clock */}
              <span className="text-white text-sm font-medium select-none ml-1 cursor-pointer hover:opacity-80 transition-opacity duration-150">
                {currentTime}
              </span>
            </div>
          </div>
        </div>
      </div>

      {/* APPLE DROPDOWN */}
      <MenuDropdown
        isOpen={activeMenu === "apple"}
        onClose={closeDropdown}
        items={APPLE_MENU_ITEMS}
        position={dropdownPosition}
        onAction={handleMenuAction}
      />

      {/* OTHER MENUS */}
      {menus.map((menu) => (
        <MenuDropdown
          key={menu.label}
          isOpen={activeMenu === menu.label}
          onClose={closeDropdown}
          items={menu.items ?? []}
          position={dropdownPosition}
          onAction={handleMenuAction}
        />
      ))}
    </div>
  );
};
export default MacOSMenuBar;